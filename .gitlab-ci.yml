image: debian

before_script:
  - apt update && apt install -y openssh-client sshpass  # Instalar os clientes SSH e sshpass

stages:
  - deploy

deploy_production:
  stage: deploy
  script:
    - echo "ðŸš€ Conectando ao servidor de produÃ§Ã£o e rodando o script de deploy..."
    - sshpass -v -p $SSHPASS ssh -o "StrictHostKeyChecking no" $USERNAME@$SERVER_IP_PROD "cd $SERVER_PATH_PROD && bash ./rebuild_sisalmox.sh"
    - echo "ðŸ”‘ Gerando chave da aplicaÃ§Ã£o Laravel no servidor..."
    - sshpass -v -p $SSHPASS ssh $USERNAME@$SERVER_IP_PROD "docker exec -it sisalmox php artisan key:generate"
  only:
    - master
  environment:
    name: production
    url: http://localhost:3010/login

deploy_develop:
  stage: deploy
  script:
    - echo "ðŸš€ Conectando ao servidor de desenvolvimento e rodando o script de deploy..."
    - sshpass -v -p $SSHPASS ssh -o "StrictHostKeyChecking no" $USERNAME@$SERVER_IP_DEV "cd $SERVER_PATH_DEV && bash ./rebuild_sisalmox.sh"
    - echo "ðŸ”‘ Gerando chave da aplicaÃ§Ã£o Laravel no servidor..."
    - sshpass -v -p $SSHPASS ssh $USERNAME@$SERVER_IP_DEV "docker exec -it sisalmox php artisan key:generate"
  only:
    - dev
  environment:
    name: development
    url: http://localhost:3010/login
